<?xml version="1.0" encoding="windows-1251"?>

<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../../../../Settings/schemas/state-machine.xsd">
    <states inital-state="INITIAL"
            description="МС документа, не требующего подтверждения сотрудником банка и направленного прямо в ритейл" saveNodeInfo="true">

        <sequences-handlers>
            <sequence name="employee-save-handlers-sequence">
                <handler class="com.rssl.phizic.business.payments.forms.meta.TestClientBlockedHandler"/>
                <handler class="com.rssl.phizic.business.payments.forms.meta.handlers.subscriptions.CheckExistsCardsAutoTransfersHandler">
                    <enabled class="com.rssl.phizic.business.payments.forms.meta.filters.ApplicationDocumentHandlerFilter">
                        <parameter name="application" value="PhizIA"/>
                    </enabled>
                </handler>
                <handler class="com.rssl.phizic.business.payments.ValidateWayCardHandler"/>
                <!--!!!TODO оффлайн-->
                <!--<handler class="com.rssl.phizic.business.payments.forms.meta.OfflineDelayedRurPaymentHandler"/>-->
                <handler class="com.rssl.phizic.business.payments.forms.meta.SetConversionOperationHandler">
                    <enabled class="com.rssl.phizic.business.payments.forms.meta.ConversionOperationFilter"/>
                </handler>
                <handler class="com.rssl.phizic.business.payments.forms.meta.handlers.subscriptions.UpdateReceiverInfoByPhoneHandler">
                    <enabled class="com.rssl.phizic.business.payments.forms.meta.GateDocumentTypeFilter">
                        <parameter name="className" value="com.rssl.phizic.gate.payments.autosubscriptions.ExternalCardsTransferToOurBankLongOffer"/>
                    </enabled>
                </handler>
                <handler class="com.rssl.phizic.business.payments.forms.meta.handlers.subscriptions.UpdateReceiverInfoByPhoneHandler">
                    <enabled class="com.rssl.phizic.business.payments.forms.meta.GateDocumentTypeFilter">
                        <parameter name="className" value="com.rssl.phizic.gate.payments.autosubscriptions.ExternalCardsTransferToOtherBankLongOffer"/>
                    </enabled>
                </handler>
                <handler class="com.rssl.phizic.business.documents.payments.stateMachine.handlers.P2PCheckChargeOffCardToMobilBankHandler">
                    <parameter name="prohibition-message"   value="Для выбранной карты не подключена услуга «Мобильный банк». Пожалуйста, укажите другую карту списания."/>
                    <parameter name="warning-message"       value="Клиент не сможет получать SMS-сообщения об операциях по данному автоплатежу, потому что к карте списания не подключена услуга «Мобильный банк». Для получения SMS-сообщений необходимо подключить услугу «Мобильный банк» любым удобным клиенту способом. &lt;/br&gt;Для завершения подключения автоплатежа нажмите на кнопку «Продолжить»."/>
                </handler>
                <handler class="com.rssl.phizic.business.payments.forms.meta.DefaultCommissionSaveHandler"/>
            </sequence>

            <sequence name="client-save-handlers-sequence">
                <handler class="com.rssl.phizic.business.payments.forms.meta.handlers.subscriptions.CheckExistsCardsAutoTransfersHandler">
                    <enabled class="com.rssl.phizic.business.payments.forms.meta.filters.ApplicationDocumentHandlerFilter">
                        <parameter name="application" value="PhizIC"/>
                    </enabled>
                </handler>
                <handler class="com.rssl.phizic.business.payments.ValidateWayCardHandler"/>
                <!--!!!TODO оффлайн-->
                <!--<handler class="com.rssl.phizic.business.payments.forms.meta.OfflineDelayedRurPaymentHandler"/>-->
                <handler class="com.rssl.phizic.business.payments.forms.meta.SetConversionOperationHandler">
                    <enabled class="com.rssl.phizic.business.payments.forms.meta.ConversionOperationFilter"/>
                </handler>
                <handler class="com.rssl.phizic.business.payments.forms.meta.handlers.subscriptions.UpdateReceiverInfoByPhoneHandler">
                    <enabled class="com.rssl.phizic.business.payments.forms.meta.GateDocumentTypeFilter">
                        <parameter name="className" value="com.rssl.phizic.gate.payments.autosubscriptions.ExternalCardsTransferToOurBankLongOffer"/>
                    </enabled>
                </handler>
                <handler class="com.rssl.phizic.business.payments.forms.meta.handlers.subscriptions.UpdateReceiverInfoByPhoneHandler">
                    <enabled class="com.rssl.phizic.business.payments.forms.meta.GateDocumentTypeFilter">
                        <parameter name="className" value="com.rssl.phizic.gate.payments.autosubscriptions.ExternalCardsTransferToOtherBankLongOffer"/>
                    </enabled>
                </handler>
                <handler class="com.rssl.phizic.business.documents.payments.stateMachine.handlers.P2PCheckChargeOffCardToMobilBankHandler">
                    <parameter name="warning-message" value="Вы не сможете получать SMS-сообщения об операциях по данному автоплатежу, потому что к карте списания не подключена услуга «Мобильный банк». Для получения SMS-сообщений подключите услугу «Мобильный банк» через Контактный центр Сбербанка. &lt;/br&gt;Для завершения подключения автоплатежа нажмите на кнопку «Продолжить»."/>
                </handler>
                <handler class="com.rssl.phizic.business.payments.forms.meta.DefaultCommissionSaveHandler"/>
            </sequence>

            <sequence name="pre-confirm-handlers-sequence">
                <handler class="com.rssl.phizic.business.documents.payments.stateMachine.handlers.SetChannelTypeP2PAutoTransferHandler"/>
                <handler class="com.rssl.phizic.business.payments.ValidatePaymentAccountHandler">
                    <parameter name="checkType" value="payer"/>
                </handler>
                <!-- проверка по стоп-листу -->
                <handler class="com.rssl.phizic.business.payments.forms.meta.SimpleBusinessDocumentDateAction"/>
                <handler class="com.rssl.phizic.business.payments.forms.meta.CheckLongOfferStartDateHandler"/>
            </sequence>

            <sequence name="confirm-handlers-sequence">
                <handler class="com.rssl.phizic.business.ext.sbrf.payments.handlers.SetAutopayNumberHandler"/>
                <handler class="com.rssl.phizic.business.payments.forms.meta.DefaultBusinessDocumentSender"/>
                <handler class="com.rssl.phizic.business.payments.forms.meta.PostUpdateDocumentHandler"/>
                <handler class="com.rssl.phizic.business.payments.forms.meta.CacheClearHandler"/>
            </sequence>

            <sequence name="execute-handlers-sequence">
                <handler class="com.rssl.phizic.business.payments.forms.meta.SetClientMessageKey"/>
                <handler class="com.rssl.phizic.business.payments.forms.meta.CreateNotificationHandler"/>
            </sequence>
        </sequences-handlers>

		<state id="INITIAL" description="Вы создали, но еще не сохранили документ"
               client-form="/private/payments/payment.do"
               employee-form="/private/payments/edit.do"
               system-resolver="com.rssl.phizic.business.payments.ERIBSystemNameResolver">

			<events>
                <event name="INITIAL" description="Редактирование документа клиентом" type="client">
                    <next-states default="INITIAL"/>
                </event>

				<event name="SAVE" description="Сохранение документа клиентом"  type="client">
                    <next-states default="INITIAL_LONG_OFFER">
                        <handlers>
                            <sequence-handlers-ref name="client-save-handlers-sequence"/>
                        </handlers>
                    </next-states>
				</event>

				<event name="SAVE" description="Сохранение документа сотрудником банка"  type="employee">
                    <next-states default="INITIAL_LONG_OFFER">
                        <handlers>
                            <sequence-handlers-ref name="employee-save-handlers-sequence"/>
                        </handlers>
                    </next-states>
				</event>

                <event name="REFUSE" description="Отказ в исполнении документа" type="system">
                    <handlers>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.SetExecutionDateHandler"/>
       				</handlers>
                    <next-states default="REFUSED">
                        <handlers>
                            <sequence-handlers-ref name="execute-handlers-sequence"/>
                        </handlers>
                    </next-states>
                </event>

                <event name="DELETE" description="Удалить документ" type="client">
                    <next-states default="DELETED"/>
                </event>

                <event name="DELETE" description="Удалить документ" type="system">
                    <next-states default="DELETED"/>
                </event>
			</events>
		</state>

        <state id="INITIAL_LONG_OFFER" description="Ввод параметров автоплатежа"
               client-form="/private/payments/payment.do"
               employee-form="/private/payments/edit.do"
               system-resolver="com.rssl.phizic.business.payments.ERIBSystemNameResolver">

			<events>
                <event name="EDIT" description="Редактирование документа" type="client">
                    <handlers>
                        <handler class="com.rssl.phizic.business.documents.payments.stateMachine.handlers.EditP2PAutoTransferHandler"/>
                    </handlers>
                    <next-states default="INITIAL"/>
				</event>

                <event name="EDIT" description="Редактирование документа" type="employee">
                    <handlers>
                        <handler class="com.rssl.phizic.business.documents.payments.stateMachine.handlers.EditP2PAutoTransferHandler"/>
                    </handlers>
                    <next-states default="INITIAL"/>
				</event>

                <event name="SAVE" description="Сохранение документа клиентом"  type="client">
                    <next-states default="SAVED">
                        <handlers>
                            <sequence-handlers-ref name="client-save-handlers-sequence"/>
                        </handlers>
                    </next-states>
				</event>

                <event name="SAVE" description="Сохранение документа сотрудником банка"  type="employee">
                    <next-states default="SAVED">
                        <handlers>
                            <sequence-handlers-ref name="employee-save-handlers-sequence"/>
                        </handlers>
                    </next-states>
				</event>

                <event name="REFUSE" description="Отказ в исполнении документа" type="system">
                    <handlers>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.SetExecutionDateHandler"/>
       				</handlers>

                    <next-states default="REFUSED">
                        <handlers>
                            <sequence-handlers-ref name="execute-handlers-sequence"/>
                        </handlers>
                    </next-states>
                </event>

                <event name="DELETE" description="Удалить документ" type="client">
                    <next-states default="DELETED"/>
                </event>

                <event name="DELETE" description="Удалить документ" type="system">
                    <next-states default="DELETED"/>
                </event>
			</events>
		</state>

        <state id="SAVED" description="Вы сохранили, но еще не подтвердили документ."
               client-form="/private/payments/confirm.do"
               employee-form="/private/payments/confirm.do"
               system-resolver="com.rssl.phizic.business.payments.ERIBSystemNameResolver">

            <handlers>
                <handler class="com.rssl.phizic.business.payments.forms.meta.ClearOfflineDelayedRowHandler"/>
            </handlers>

			<events>
                <event name="EDIT" description="Редактирование документа" type="client">
                    <handlers>
                        <handler class="com.rssl.phizic.business.documents.payments.stateMachine.handlers.EditP2PAutoTransferHandler"/>
                    </handlers>
                    <next-states default="INITIAL_LONG_OFFER"/>
				</event>

                <event name="EDIT" description="Редактирование документа" type="employee">
                    <handlers>
                        <handler class="com.rssl.phizic.business.documents.payments.stateMachine.handlers.EditP2PAutoTransferHandler"/>
                    </handlers>
                    <next-states default="INITIAL_LONG_OFFER"/>
				</event>

				<event name="CONFIRM" description="Отправка документа клиентом" type="client" lock="true">
					<handlers>
                        <!--TODO оффлайн-->
                        <!--<handler class="com.rssl.phizic.business.payments.forms.meta.OfflineDelayedRurPaymentHandler"/>-->
                        <handler class="com.rssl.phizic.business.payments.forms.meta.handlers.subscriptions.CheckExistsCardsAutoTransfersHandler"/>
                        <sequence-handlers-ref name="pre-confirm-handlers-sequence"/>
					</handlers>
                    <next-states default="DISPATCHED">
                        <next-state condition="com.rssl.phizic.business.payments.forms.meta.conditions.OfflineDelayedCondition" state="OFFLINE_DELAYED">
                            <handlers>
                                <!-- сброс текстовки -->
                                <handler class="com.rssl.phizic.business.payments.forms.meta.SetClientMessageKey"/>
                            </handlers>
                        </next-state>
                        <handlers>
                            <sequence-handlers-ref name="confirm-handlers-sequence"/>
                         </handlers>
                    </next-states>
                </event>

                <event name="CONFIRM" description="Отправка документа сотрудникм" type="employee" lock="true">
					<handlers>
                        <!--TODO оффлайн-->
                        <!--<handler class="com.rssl.phizic.business.payments.forms.meta.OfflineDelayedRurPaymentHandler"/>-->
                        <handler class="com.rssl.phizic.business.payments.forms.meta.TestClientBlockedHandler"/>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.SetConfirmEmployeeIdHandler"/>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.handlers.subscriptions.CheckExistsCardsAutoTransfersHandler"/>
                        <sequence-handlers-ref name="pre-confirm-handlers-sequence"/>
					</handlers>
                    <next-states default="DISPATCHED">
                        <next-state condition="com.rssl.phizic.business.payments.forms.meta.conditions.OfflineDelayedCondition" state="OFFLINE_DELAYED">
                            <handlers>
                                <!-- сброс текстовки -->
                                <handler class="com.rssl.phizic.business.payments.forms.meta.SetClientMessageKey"/>
                            </handlers>
                        </next-state>
                        <handlers>
                            <sequence-handlers-ref name="confirm-handlers-sequence"/>
                         </handlers>
                    </next-states>
                </event>

                <event name="DOUNKNOW" description="таймаут" type="client">
                    <next-states default="UNKNOW"/>
                </event>

                <event name="DOWAITCONFIRM" description="Перевод документа в ожидание дополнительной обработки" type="client">
                    <handlers>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.handlers.subscriptions.CheckExistsCardsAutoTransfersHandler"/>
                        <sequence-handlers-ref name="pre-confirm-handlers-sequence"/>
					</handlers>
                    <next-states default="WAIT_CONFIRM">
                        <handlers>
                            <handler class="com.rssl.phizic.business.payments.forms.meta.SimpleBusinessDocumentDateAction"/>
                            <sequence-handlers-ref name="execute-handlers-sequence"/>
                       </handlers>
                    </next-states>
                </event>

                <event name="REFUSE" description="Отказ в исполнении документа" type="system">
                    <handlers>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.SetExecutionDateHandler"/>
       				</handlers>
                    <next-states default="REFUSED">
                        <handlers>
                            <sequence-handlers-ref name="execute-handlers-sequence"/>
                        </handlers>
                    </next-states>
                </event>

                <event name="DELETE" description="Удалить документ" type="client">
                    <next-states default="DELETED"/>
                </event>

                <event name="DELETE" description="Удалить документ" type="system">
                    <next-states default="DELETED"/>
                </event>
			</events>
		</state>

        <state id="WAIT_CONFIRM" description="Документ, ожидающий дополнительного подтверждения"
               client-form="/private/payments/view.do"
               employee-form="/private/payments/view.do"
               system-resolver="com.rssl.phizic.business.payments.ERIBSystemNameResolver">

            <events>
                <event name="DOUNKNOW" description="таймаут" type="employee">
                    <next-states default="UNKNOW"/>
                </event>

                <event name="CONFIRM" type="employee" lock="true">
                    <!--TODO-->
                    <!--
                    <handlers>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.OfflineDelayedRurPaymentHandler"/>
                    </handlers>
                    -->
                    <handlers>
                        <sequence-handlers-ref name="pre-confirm-handlers-sequence"/>
                    </handlers>
                    <next-states default="DISPATCHED">
                        <next-state condition="com.rssl.phizic.business.payments.forms.meta.conditions.OfflineDelayedCondition" state="OFFLINE_DELAYED">
                            <handlers>
                                <!-- сброс текстовки -->
                                <handler class="com.rssl.phizic.business.payments.forms.meta.SetClientMessageKey"/>
                            </handlers>
                        </next-state>
                        <handlers>
                            <handler class="com.rssl.phizic.business.ext.sbrf.payments.handlers.SetAutopayNumberHandler"/>
                            <handler class="com.rssl.phizic.business.payments.forms.meta.DefaultBusinessDocumentSender"/>
                            <handler class="com.rssl.phizic.business.payments.forms.meta.PostUpdateDocumentHandler"/>
                         </handlers>
                    </next-states>
                </event>

                <event name="DELETE" description="Удалить документ" type="system">
                    <handlers>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.RollbackUserLimitHandler"/>
                    </handlers>
                    <next-states default="DELETED"/>
                </event>

                <event name="DELETE" description="Удалить документ" type="client">
                    <handlers>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.RollbackUserLimitHandler"/>
                    </handlers>
                    <next-states default="DELETED"/>
                </event>
                <event name="REFUSE" description="Отклонить заявку" type="employee">
                    <next-states default="REFUSED"/>
                </event>
            </events>
        </state>

        <state id="UNKNOW" description="Документ подтвержден и передан на обработку в банк."
               client-form="/private/payments/view.do"
               employee-form="/private/payments/view.do"
               system-resolver="com.rssl.phizic.business.payments.ERIBSystemNameResolver">

            <events>
                <event name="DOUNKNOW" description="таймаут" type="system">
                    <next-states default="UNKNOW"/>
                </event>

                <event name="ERROR" description="Ошибка исполнения документа" type="system">
                    <next-states default="ERROR"/>
                </event>

                <event name="REFUSE" description="Отказ в исполнении документа" type="system">
                    <handlers>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.SetExecutionDateHandler"/>
       				</handlers>
                    <next-states default="REFUSED">
                        <handlers>
                            <sequence-handlers-ref name="execute-handlers-sequence"/>
                        </handlers>
                    </next-states>
                </event>

                <event name="SPECIFY" description="Уточнение состояния документа" type="employee" lock="true">
					<handlers>
                        <!--TODO оффлайн-->
                        <!--<handler class="com.rssl.phizic.business.payments.forms.meta.OfflineDelayedRurPaymentHandler"/>-->
                        <sequence-handlers-ref name="pre-confirm-handlers-sequence"/>
					</handlers>
                    <next-states default="DISPATCHED">
                        <next-state condition="com.rssl.phizic.business.payments.forms.meta.conditions.OfflineDelayedCondition" state="OFFLINE_DELAYED">
                            <handlers>
                                <!-- сброс текстовки -->
                                <handler class="com.rssl.phizic.business.payments.forms.meta.SetClientMessageKey"/>
                            </handlers>
                        </next-state>
                        <handlers>
                            <handler class="com.rssl.phizic.business.ext.sbrf.payments.handlers.SetAutopayNumberHandler"/>
                            <handler class="com.rssl.phizic.business.payments.forms.meta.DefaultBusinessDocumentSender"/>
                            <handler class="com.rssl.phizic.business.payments.forms.meta.PostUpdateDocumentHandler"/>
                        </handlers>
                    </next-states>
                </event>

                <event name="EXECUTE" description="Подтверждение документа сотрудником" type="employee">
                    <handlers>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.PostUpdateDocumentHandler"/>
                    </handlers>
                    <next-states default="EXECUTED">
                        <handlers>
                            <sequence-handlers-ref name="execute-handlers-sequence"/>
                        </handlers>
                    </next-states>
                </event>

                <event name="EXECUTE" description="Подтверждение документа системой" type="system">
                     <handlers>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.PostUpdateDocumentHandler"/>
                    </handlers>
                    <next-states default="EXECUTED">
                        <handlers>
                            <sequence-handlers-ref name="execute-handlers-sequence"/>
                        </handlers>
                    </next-states>
                </event>

                <event name="REFUSE" description="Отказ в исполнении документа" type="employee">
                    <handlers>
                         <handler class="com.rssl.phizic.business.payments.forms.meta.SetExecutionDateHandler"/>
       				</handlers>
                    <next-states default="REFUSED">
                        <handlers>
                            <sequence-handlers-ref name="execute-handlers-sequence"/>
                        </handlers>
                    </next-states>
                </event>

                <event name="REFUSE" description="Отказ в исполнении документа" type="system">
                    <handlers>
                         <handler class="com.rssl.phizic.business.payments.forms.meta.SetExecutionDateHandler"/>
       				</handlers>
                    <next-states default="REFUSED">
                        <handlers>
                            <sequence-handlers-ref name="execute-handlers-sequence"/>
                        </handlers>
                    </next-states>
                </event>
            </events>
		</state>

        <state id="OFFLINE_DELAYED" description="Ожидается обработка документа в банке."
               client-form="/private/payments/view.do"
               employee-form="/private/payments/view.do"
               system-resolver="com.rssl.phizic.business.payments.ERIBSystemNameResolver">

            <handlers>
                <handler class="com.rssl.phizic.business.payments.forms.meta.ClearOfflineDelayedRowHandler"/>
            </handlers>
			<events>
                <event name="DOUNKNOW" description="таймаут" type="system">
                    <next-states default="UNKNOW"/>
                </event>

                <event name="DISPATCH" description="Отправка документа клиентом" type="system" >
                    <handlers>
                        <sequence-handlers-ref name="pre-confirm-handlers-sequence"/>
					</handlers>
                    <next-states default="DISPATCHED">
                        <next-state condition="com.rssl.phizic.business.payments.forms.meta.conditions.OfflineDelayedCondition" state="OFFLINE_DELAYED">
                            <handlers>
                                <!-- сброс текстовки -->
                                <handler class="com.rssl.phizic.business.payments.forms.meta.SetClientMessageKey"/>
                            </handlers>
                        </next-state>
                        <handlers>
                            <sequence-handlers-ref name="confirm-handlers-sequence"/>
                         </handlers>
                    </next-states>
                </event>

                <event name="REFUSE" description="Отказ в исполнении документа" type="system">
                    <handlers>
<!--
                        <handler class="com.rssl.phizic.messaging.payments.handlers.SmsOfRefuseOperationHandler"/>
-->
                        <handler class="com.rssl.phizic.business.payments.forms.meta.RollbackUserLimitHandler"/>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.SetExecutionDateHandler"/>
       				</handlers>
                    <next-states default="REFUSED">
                        <handlers>
                            <sequence-handlers-ref name="execute-handlers-sequence"/>
                        </handlers>
                    </next-states>
                </event>

                <event name="ERROR" description="Ошибка исполнения документа" type="system">
<!--
                    <handlers>
                        <handler class="com.rssl.phizic.messaging.payments.handlers.SmsOfRefuseOperationHandler"/>
                    </handlers>
-->
                    <next-states default="ERROR"/>
                </event>

                <event name="EXECUTE" description="Исполнение документа сотрудником банка" type="employee">
                    <handlers>
                         <handler class="com.rssl.phizic.business.payments.forms.meta.SetExecutionDateHandler"/>
       				</handlers>
                    <next-states default="EXECUTED"/>
                </event>

                <event name="REFUSE" description="Отказ исполнения документа сотрудником банка" type="employee">
                    <handlers>
<!--
                        <handler class="com.rssl.phizic.messaging.payments.handlers.SmsOfRefuseOperationHandler"/>
-->
                        <handler class="com.rssl.phizic.business.payments.forms.meta.RollbackUserLimitHandler"/>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.SetExecutionDateHandler"/>
       				</handlers>
                    <next-states default="REFUSED">
                        <handlers>
                            <handler class="com.rssl.phizic.business.payments.forms.meta.SetClientMessageKey"/>
                            <handler class="com.rssl.phizic.business.payments.forms.meta.CreateNotificationHandler"/>
                        </handlers>
                    </next-states>
                </event>

                <event name="RECALL" description="Отзыв документа" type="client">
                    <handlers>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.RollbackUserLimitHandler"/>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.SetExecutionDateHandler"/>
                    </handlers>
                    <next-states default="RECALLED"/>
                </event>
            </events>
		</state>

		<state id="DISPATCHED" description="Документ подтвержден и передан на обработку в банк."
               client-form="/private/payments/view.do"
               employee-form="/private/payments/view.do"
               system-resolver="com.rssl.phizic.business.payments.ABSSystemNameResolver">

			<events>
                <event name="DOUNKNOW" description="таймаут" type="system">
                    <next-states default="UNKNOW"/>
                </event>

<!--
                <event name="REPEAT_SEND" description="Подтверждение документа системой" type="system">
                    <next-states default="DISPATCHED">
                        <handlers>
                            <handler class="com.rssl.phizic.business.payments.forms.meta.BusinessDocumentRepeatSendHandler"/>
                            &lt;!&ndash; установка сообщения о сроках исполнения платежа &ndash;&gt;
                            <handler class="com.rssl.phizic.business.payments.forms.meta.SetClientMessageKey">
                                <parameter name="key" value="operation.transfer.message"/>
                            </handler>
                        </handlers>
                    </next-states>
                </event>
-->

				<event name="EXECUTE" description="Подтверждение документа системой" type="system">
                    <handlers>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.PostUpdateDocumentHandler"/>
                    </handlers>
                    <next-states default="EXECUTED">
                        <handlers>
                            <sequence-handlers-ref name="execute-handlers-sequence"/>
                        </handlers>
                    </next-states>
				</event>

                <event name="EXECUTE" description="Подтверждение документа сотрудником" type="employee">
                    <handlers>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.PostUpdateDocumentHandler"/>
                    </handlers>
                    <next-states default="EXECUTED">
                        <handlers>
                            <sequence-handlers-ref name="execute-handlers-sequence"/>
                        </handlers>
                    </next-states>
                </event>

				<event name="REFUSE" description="Отказ в исполнении документа" type="system">
                    <handlers>
                          <!-- откатываем лимит -->
                        <handler class="com.rssl.phizic.business.payments.forms.meta.RollbackUserLimitHandler"/>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.SetExecutionDateHandler"/>
       				</handlers>
                    <next-states default="REFUSED">
                        <handlers>
                            <handler class="com.rssl.phizic.business.payments.forms.meta.SetClientMessageKey"/>
                            <handler class="com.rssl.phizic.business.payments.forms.meta.CreateNotificationHandler"/>
                        </handlers>
                    </next-states>
				</event>

                <event name="REFUSE" description="Отказ в исполнении документа" type="employee">
                    <handlers>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.RollbackUserLimitHandler"/>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.SetExecutionDateHandler"/>
       				</handlers>
                    <next-states default="REFUSED">
                        <handlers>
                            <sequence-handlers-ref name="execute-handlers-sequence"/>
                        </handlers>
                    </next-states>
				</event>

				<event name="ERROR" description="При работе с документом произошла ошибка" type="system">
                    <handlers>
                        <!-- откатываем лимит -->
                        <handler class="com.rssl.phizic.business.payments.forms.meta.RollbackUserLimitHandler"/>
                    </handlers>
                    <next-states default="ERROR"/>
				</event>
			</events>
		</state>

        <state id="EXECUTED" description="Операция успешно исполнена банком."
               client-form="/private/payments/view.do"
               employee-form="/private/payments/view.do"
               system-resolver="com.rssl.phizic.business.payments.ERIBSystemNameResolver">

        </state>

		<state id="REFUSED" description="Вам отказано в исполнении операции по какой-либо причине."
               client-form="/private/payments/view.do"
               employee-form="/private/payments/view.do"
               system-resolver="com.rssl.phizic.business.payments.ERIBSystemNameResolver">

        </state>

		<state id="ERROR" description="Платеж не может быть исполнен, Вам необходимо обратиться в банк."
               client-form="/private/payments/view.do"
               employee-form="/private/payments/view.do"
               system-resolver="com.rssl.phizic.business.payments.ERIBSystemNameResolver">

            <events>
                <event name="EXECUTE" description="Подтверждение документа сотрудником" type="employee">
                    <handlers>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.PostUpdateDocumentHandler"/>
                    </handlers>
                    <next-states default="EXECUTED">
                        <handlers>
                            <sequence-handlers-ref name="execute-handlers-sequence"/>
                        </handlers>
                    </next-states>
                </event>

                <event name="REFUSE" description="Отказ в исполнении документа" type="employee">
                    <handlers>
                         <handler class="com.rssl.phizic.business.payments.forms.meta.SetExecutionDateHandler"/>
       				</handlers>
                    <next-states default="REFUSED">
                        <handlers>
                            <sequence-handlers-ref name="execute-handlers-sequence"/>
                        </handlers>
                    </next-states>
                </event>
		    </events>
        </state>

        <state id="DELETED" description="Документ удален."
               system-resolver="com.rssl.phizic.business.payments.ERIBSystemNameResolver">

        </state>
	</states>
</config>