<?xml version="1.0" encoding="windows-1251"?>

<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="../../../../../Settings/schemas/state-machine.xsd">

	<states inital-state="INITIAL"
	        description="Машина состояний заявки на регистрацию в программе лояльности" saveNodeInfo="true">

		<state id="INITIAL"
               description="Вы создали, но еще не сохранили документ."
			   client-form="/private/payments/payment.do"
               system-resolver="com.rssl.phizic.business.payments.ERIBSystemNameResolver">

            <handlers>
                <handler class="com.rssl.phizic.business.payments.forms.meta.LoyaltyProgramRegistrationClaimCheckHandler"/>
            </handlers>
			<events>
                <event name="SAVE" description="Сохранение и отправка документа клиентом"  type="client">
                    <handlers>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.LoyaltyProgramRegistrationClaimPhoneHandler"/>
						<handler class="com.rssl.phizic.business.payments.forms.meta.LoyaltyProgramRegistrationClaimSender">
                            <parameter name="urlToRedirect" value="/private/loyalty/detail.do?regError=true"/>
						</handler>
					</handlers>
                    <next-states default="EXECUTED">
                        <handlers>
                            <handler class="com.rssl.phizic.business.payments.forms.meta.SetExecutionDateHandler"/>
                            <handler class="com.rssl.phizic.business.payments.forms.meta.SetLoyaltyProgramLinkHandler"/>
                        </handlers>
                    </next-states>
				</event>
                <event name="DOUNKNOW" description="таймаут" type="client">
                    <next-states default="UNKNOW"/>
                </event>
			</events>
		</state>

        <state
			id="EXECUTED" description="Заявка успешно исполнена банком."
			client-form="/private/payments/view.do"
            system-resolver="com.rssl.phizic.business.payments.ERIBSystemNameResolver">
        </state>

        <state id="UNKNOW" description="Статус документа не определен. Пожалуйста, обратитесь в Контактный центр банка для уточнения информации."
			   client-form="/private/payments/view.do"
               employee-form="/claims/claim.do"
               system-resolver="com.rssl.phizic.business.payments.ERIBSystemNameResolver">
            <events>
                <event name="REFUSE" description="Отказ в исполнении документа" type="employee">
                    <handlers>
                         <handler class="com.rssl.phizic.business.payments.forms.meta.SetExecutionDateHandler"/>
                    </handlers>
                    <next-states default="REFUSED"/>
                </event>
                <event name="REFUSE" description="Отказ в исполнении документа" type="system">
                    <handlers>
                         <handler class="com.rssl.phizic.business.payments.forms.meta.SetExecutionDateHandler"/>
                    </handlers>
                    <next-states default="REFUSED"/>
                </event>
                <event name="ERROR" description="Ошибка исполнения документа" type="system">
                    <next-states default="ERROR"/>
                </event>
            </events>
        </state>
	</states>

</config>
