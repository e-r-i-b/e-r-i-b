<?xml version="1.0" encoding="windows-1251"?>

<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="../../../../../Settings/schemas/state-machine.xsd">

	<states inital-state="INITIAL"
	        description="Машина состояний заявки на возврат товара из интернет-магазина">

		<state id="INITIAL"
               description="Заявка не сохранена."
               system-resolver="com.rssl.phizic.business.payments.ERIBSystemNameResolver" saveNodeInfo="true">
			<events>
				<event name="DISPATCH" description="Отправка документа"  type="system">
                    <handlers>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.DefaultBusinessDocumentSender"/>
       				</handlers>
                    <next-states default="DISPATCHED">
                        <next-state condition="com.rssl.phizic.business.ext.sbrf.payments.forms.meta.ESBERIBPaymentsCondition" state="EXECUTED">
                            <handlers>
                                <handler class="com.rssl.phizic.business.payments.forms.meta.SetExecutionDateHandler"/>
                                <handler class="com.rssl.phizic.business.payments.forms.meta.ChangeRecallStateHandler">
                                    <parameter name="state" value="EXECUTED"/>
                                </handler>
                            </handlers>
                        </next-state>
                    </next-states>
				</event>
                <event name="ERROR" description="Ошибка исполнения платежа" type="system">
                    <handlers>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.ChangeRecallStateHandler">
                            <parameter name="state" value="ERROR"/>
                        </handler>
                    </handlers>
                    <next-states default="ERROR"/>
                </event>
                <event name="DOUNKNOW" description="таймаут" type="system">
                    <next-states default="UNKNOW"/>
                </event>
			</events>
		</state>

        <state id="DISPATCHED" description="Отправка документа."
               client-form="/private/payments/view.do"
               employee-form="/claims/claim.do"
               system-resolver="com.rssl.phizic.business.payments.IQWaveSystemNameResolver">
            <events>
				<event name="EXECUTE" description="Подтверждение проведения документа"  type="system">
                    <handlers>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.SetExecutionDateHandler"/>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.ChangeRecallStateHandler">
                            <parameter name="state" value="EXECUTED"/>
                        </handler>
       				</handlers>
                    <next-states default="EXECUTED"/>
				</event>
                <event name="ERROR" description="Ошибка исполнения платежа" type="system">
                    <handlers>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.ChangeRecallStateHandler">
                            <parameter name="state" value="ERROR"/>
                        </handler>
                    </handlers>
                    <next-states default="ERROR"/>
                </event>
                <event name="REFUSE" description="Отказ в исполнении документа" type="system">
                    <handlers>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.SetExecutionDateHandler"/>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.ChangeRecallStateHandler">
                            <parameter name="state" value="REFUSED"/>
                        </handler>
       				</handlers>
                    <next-states default="REFUSED"/>
                </event>
                <event name="REFUSE" description="Отказ в исполнении документа" type="employee">
                    <handlers>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.SetExecutionDateHandler"/>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.ChangeRecallStateHandler">
                            <parameter name="state" value="REFUSED"/>
                        </handler>
       				</handlers>
                    <next-states default="REFUSED"/>
                </event>
			</events>
        </state>

		<state id="EXECUTED" description="Операция успешно исполнена банком."
               client-form="/private/payments/view.do"
               employee-form="/claims/claim.do"
               system-resolver="com.rssl.phizic.business.payments.ERIBSystemNameResolver">
        </state>

		<state
			id="ERROR" description="Операция не может быть исполнена, Вам необходимо обратиться в банк."
			client-form="/private/payments/view.do"
			employee-form="/claims/claim.do"
            system-resolver="com.rssl.phizic.business.payments.ERIBSystemNameResolver">
        </state>

        <state id="UNKNOW" description="Статус документа не определен. Пожалуйста, обратитесь в Контактный центр банка для уточнения информации."
			   client-form="/private/payments/view.do"
               employee-form="/claims/claim.do"
               system-resolver="com.rssl.phizic.business.payments.ERIBSystemNameResolver">
            <events>
                <event name="EXECUTE" description="Подтверждение документа сотрудником" type="employee">
                    <handlers>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.SetExecutionDateHandler"/>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.ChangeRecallStateHandler">
                            <parameter name="state" value="EXECUTED"/>
                        </handler>
                    </handlers>
                    <next-states default="EXECUTED"/>
                </event>
                <event name="REFUSE" description="Отказ в исполнении документа" type="employee">
                    <handlers>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.SetExecutionDateHandler"/>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.ChangeRecallStateHandler">
                            <parameter name="state" value="EXECUTED"/>
                        </handler>
       				</handlers>
                    <next-states default="REFUSED"/>
                </event>
                <event name="REFUSE" description="Отказ в исполнении документа" type="system">
                    <handlers>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.SetExecutionDateHandler"/>
                        <handler class="com.rssl.phizic.business.payments.forms.meta.ChangeRecallStateHandler">
                            <parameter name="state" value="EXECUTED"/>
                        </handler>
       				</handlers>
                    <next-states default="REFUSED"/>
                </event>
            </events>
        </state>

        <state id="REFUSED" description="Вам отказано в исполнении операции по какой-либо причине."
               client-form="/private/payments/view.do"
               employee-form="/claims/claim.do"
               system-resolver="com.rssl.phizic.business.payments.ERIBSystemNameResolver">
        </state>
	</states>

</config>
